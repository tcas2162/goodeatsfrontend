/**
 * 基于 Express 的 web 开发框架
 * 
 */


// 系统模块



// 第三方模块
var express = require('express');


// 本地模块
require('./global.js');
var ctrlroute = require('./sys/ctrlroute.js');


// express app
var express_app = null;



/**
 * 设置或获取 express 的 app
 */
exports.app = function(epr)
{
    if(epr){
        return express_app = epr;
    }
    checkApp(); // 检查
    return express_app;
}

/**
 * 检查 app 是否已初始化
 */
function checkApp()
{
    if(!express_app){
        throw new Error("Expre must give or init an express app !");
    }
}



/**
 * 初始化一个 express 的 app 并返回
 */
exports.init = function(port)
{
    express_app = express();
    if(port>0){
        express_app.listen(port);
    }
    return express_app;
}



/**
 * 1. 扫描 controller 并自动初始化
 * 2. 
 */
exports.ctrl = function(path, opts)
{
    checkApp(); // 检查
    return ctrlroute.scan(express_app, path, opts);
}



/**
 * 获取 expre 的库模块及函数
 */
exports.lib = function(name)
{
    return require('./lib/'+name+'.js');
}

