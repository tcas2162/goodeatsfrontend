/**
 * controller 目录文件模块的自动路由
 * 
 */


var lib_fs = require('../lib/fs.js');



/**
 * 扫描目标 controller 目录
 * 
 */
exports.scan = function(express_app, path, opts){
    
    // 扫描文件夹 建立请求监听
    var dirs = lib_fs.scan(process.cwd()+'/'+path);

    loop(dirs);

    function loop(dirs, base){
        // 文件建立
        for(var i in dirs.files){
            var module = require(dirs.files[i])
              , filename = path.basename(mdfile,'.js')
              ;
            for(var func in module){
                var path = '/'+filename+'/'+func;
                if(base)
                    path = '/'+base+path;
                initOne(path, module[func]);
            }
        }
        for(var i in dirs.folders){
            loop(dirs.folders[i], base);
        }

    }


    // app 监听
    function initOne(route, func){
        // log(route);
        app.get(route, function (req, res) {
            // 准备工作
            before(req, res);
            // 调用处理器
            func(req, res);
        });
    }

}

